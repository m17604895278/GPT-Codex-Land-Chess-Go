# 翻棋军旗 · 数据结构设计说明书（后端版 · v1）

## 一、棋盘结构
- 使用二维数组表示：
  board[row][col]

每个格子存：
- 棋子ID（或空）
- 是否可走

---

## 二、棋子（Piece）

| 字段 | 含义 |
|------|------|
| id | 唯一ID |
| type | 棋子类型（司令/炸弹/军旗等） |
| camp | 阵营（红/蓝/未知） |
| rank | 等级（比较大小用） |
| x | 横坐标 |
| y | 纵坐标 |
| flipped | 是否已翻开 |
| alive | 是否存活 |

---

## 三、玩家（Player）

| 字段 | 含义 |
|------|------|
| userId | 用户ID |
| camp | 阵营 |
| online | 是否在线 |

---

## 四、房间（Room）

| 字段 | 含义 |
|------|------|
| roomId | 房间ID |
| player1 | 玩家1 |
| player2 | 玩家2 |
| board | 棋盘 |
| pieces | 棋子集合 |
| turn | 当前回合阵营 |
| status | playing / finished |
| winner | 胜者阵营 |
| step | 步数 |

---

## 五、回合状态
- 当前回合只能：
  - flip（翻棋）
  - move（走棋）

---

## 六、吃子判定
输入：
- 攻击棋子 A
- 防守棋子 B

输出：
- A 生死
- B 生死
- 是否结束游戏

---

## 七、同步数据原则
- 服务端保存真实棋盘
- 下发给客户端：
  - flipped=false：不下发 type
  - flipped=true：下发真实 type

---

## 八、阵营状态
初始：
player1.camp = unknown  
player2.camp = unknown  

第一次翻棋后确定阵营。

---

## 九、胜负依赖数据
- 是否存在军旗  
- 是否存在可移动棋子  

---

## 十、数据存储
- 内存：Room / Board / Pieces  
- Redis：userId → roomId  
- MySQL：对局结果  

---

## 核心思想
对局本质是：
一个可变状态机  
状态 = 棋盘 + 棋子 + 回合 + 阵营  
操作 = flip / move  
结果 = 新状态或结束
